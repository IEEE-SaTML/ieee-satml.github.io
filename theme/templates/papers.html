{% extends "base.html" %}

{% macro render_paper(paper, index) %}
<blockquote>
  <div class="block" style="margin-bottom: 0.2rem">
    <strong>{{ paper["title"] }}</strong>
  </div>
  <div class="block" style="margin-bottom: 0.2rem">
  {% for author in paper["authors"] -%}
    {{ author.first }} {{ author.last }}
    {%- set this_aff = author.get("affiliation") -%}
    {%- set next_aff = None -%}
    {%- if not loop.last -%}
      {%- set next_aff = paper["authors"][loop.index].get("affiliation") -%}
    {%- endif -%}
    {%- if this_aff and this_aff != next_aff %} ({{ this_aff }}){%- endif -%}
    {%- if not loop.last -%}
      {%- if loop.index == loop.length - 1 %} and {% else %}, {% endif -%}
    {%- endif -%}
  {%- endfor %}
  </div>
  <div class="block" style="margin-bottom: 0.5rem">
    <button class="tag paper-button" onclick="toggleAbstract('{{ index }}')">
      <small style="filter: grayscale(100%);">ðŸ“ƒ</small>&nbsp;Abstract
    </button>
    {% if paper.get("arxiv") %}
    <a class="tag paper-button" href="{{ paper['arxiv'] }}" target="_blank" style="text-decoration: none !important;">
      <small style="filter: grayscale(100%);">ðŸ“š</small>&nbsp;Arxiv
    </a>
    {% endif %}
  </div>
  <div class="block" id="abstract-{{ index }}" style="margin-bottom: 0.15rem; display: none;">
    <p style="font-size: 0.9em;">{{ paper["abstract"] | safe }}</p>
  </div>
</blockquote>
{% endmacro %}

{% block content %}
<style>
.paper-button {
  color: teal !important;
  border: 1px solid #AAAAAA !important;
  text-decoration: none !important;
  cursor: pointer;
}

blockquote {
  background-color: #F8F8F8 !important;
  border-left: 2px solid #DDDDDD !important;
  margin: 0 0 0.7rem 0 !important;
  padding: 0.5rem 0rem 0.35rem 1.5rem !important; /* top right bottom left*/
}
</style>

<script>
function toggleAbstract(paperId) {
  var abstract = document.getElementById('abstract-' + paperId);
  abstract.style.display = abstract.style.display === 'none' ? 'block' : 'none';
}
</script>

<section class="section">
  <div class="container">
    <div class="content">
      <h1>{{ page.title }}</h1>
      {{ page.content }}
    </div>
  </div>
</section>

{# Extract papers into categories #}
{% set research_papers = [] %}
{% set sok_papers = [] %}
{% set position_papers = [] %}

{% for paper in PAPERS %}
  {% if paper["title"].startswith("SoK:") %}
    {% set _ = sok_papers.append(paper) %}
  {% elif paper["title"].startswith("Position:") %}
    {% set _ = position_papers.append(paper) %}
  {% else %}
    {% set _ = research_papers.append(paper) %}
  {% endif %}
{% endfor %}

{# Research Papers #}
{% if research_papers %}
<section class="section">
  <div class="container">
    <div class="content">
      <h2>Research Papers</h2>
      {% for paper in research_papers %}
        {{ render_paper(paper, 'r' + loop.index|string) }}
      {% endfor %}
    </div>
  </div>
</section>
{% endif %}

{# SoK Papers #}
{% if sok_papers %}
<section class="section">
  <div class="container">
    <div class="content">
      <h2>Systematization of Knowledge Papers</h2>
      {% for paper in sok_papers %}
        {{ render_paper(paper, 's' + loop.index|string) }}
      {% endfor %}
    </div>
  </div>
</section>
{% endif %}

{# Position Papers #}
{% if position_papers %}
<section class="section">
  <div class="container">
    <div class="content">
      <h2>Position Papers</h2>
      {% for paper in position_papers %}
        {{ render_paper(paper, 'p' + loop.index|string) }}
      {% endfor %}
    </div>
  </div>
</section>
{% endif %}

{% endblock %}